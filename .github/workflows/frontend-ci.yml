name: Frontend CI
permissions:
    contents: read

on:
    pull_request:
        paths:
            - "apps/frontend/**"

jobs:
    lint:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup-node-pnpm
            - name: Lint
              run: pnpm --filter apps/frontend lint

    test:
        needs: lint
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup-node-pnpm
            - name: Run tests
              run: pnpm --filter apps/frontend test

    build:
        needs: test
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup-node-pnpm
            - name: Build
              run: pnpm --filter apps/frontend build

    e2e:
        needs: build
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup-node-pnpm
            - uses: ./.github/actions/vercel-preview-url
              id: vercel_url
            - name: Install Playwright Browsers
              run: pnpm --filter apps/frontend exec playwright install --with-deps
            - name: Run E2E Tests
              run: pnpm --filter apps/frontend exec playwright test
              env:
                  BASE_URL: ${{ steps.vercel_url.outputs.deployment_url }}
                  NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
                  NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY }}
                  NEXT_PUBLIC_JOB_SCRAPER_URL: ${{ vars.NEXT_PUBLIC_JOB_SCRAPER_URL }}
